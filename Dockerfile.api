FROM node:22
ARG AUTH0_DOMAIN=${AUTH0_DOMAIN}
ARG AUTH0_CLIENT_ID=${AUTH0_CLIENT_ID}
ARG AUTH0_AUDIENCE=${AUTH0_AUDIENCE}
ARG AUTH0_ISSUER=${AUTH0_ISSUER}
ENV AUTH0_DOMAIN=${AUTH0_DOMAIN}
ENV AUTH0_CLIENT_ID=${AUTH0_CLIENT_ID}
ENV AUTH0_AUDIENCE=${AUTH0_AUDIENCE}
ENV AUTH0_ISSUER=${AUTH0_ISSUER}

WORKDIR /app
COPY . .
RUN npm install -g pnpm@9.15.0
RUN pnpm install
RUN pnpm build-api
CMD ["node", "apps/api/src/index.js"]