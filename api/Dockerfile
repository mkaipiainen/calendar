FROM node:22
ARG AUTH0_DOMAIN=${AUTH0_DOMAIN}
ARG AUTH0_CLIENT_ID=${AUTH0_CLIENT_ID}
ARG AUTH0_AUDIENEC=${AUTH0_AUDIENEC}
ARG AUTH0_ISSUER=${AUTH0_ISSUER}
ENV AUTH0_DOMAIN=${AUTH0_DOMAIN}
ENV AUTH0_CLIENT_ID=${AUTH0_CLIENT_ID}
ENV AUTH0_AUDIENEC=${AUTH0_AUDIENEC}
ENV AUTH0_ISSUER=${AUTH0_ISSUER}

WORKDIR /app
COPY . .
RUN npm install -g pnpm@9.7.0
RUN pnpm install
RUN pnpm build
CMD ["node", "src/index.js"]